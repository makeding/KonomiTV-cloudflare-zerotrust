import{B as E,R as p}from"./RecordedProgramList-c8g7Jb3l.js";import{H as R,N as L}from"./Navigation-CnqcZDIH.js";import{S as V}from"./SPHeaderBar-kw61mg0f.js";import{V as g}from"./Videos-d0PD3lY7.js";import{d as H,q as o,u as $,s as M,x as A,y as I,c as N,a as r,b as h,o as U,_ as k}from"./index-B7OgWKtM.js";import"./VDialog-B5uyaSNw.js";import"./VChip-CXvR9eN_.js";import"./VTextField-Cn4WKwf3.js";import"./VAvatar-CxE9IZav.js";import"./VCard-CZrRuC1N.js";import"./ssrBoot-CgU2lsL7.js";import"./VSelect-9qvNrm53.js";const F={class:"route-container"},O={class:"videos-home-container-wrapper"},T={class:"videos-home-container"},W=30*1e3,j=H({__name:"Home",setup(q){const v=o([]),_=o(0),l=o([]),u=o(0),d=o([]),c=o(0),a=o(!0),n=o(null),i=$();M(()=>i.settings.mylist,async()=>{await y()},{deep:!0}),M(()=>i.settings.watched_history,async()=>{await f()},{deep:!0});const P=async()=>{const e=await g.fetchVideos("desc",1);e&&(v.value=e.recorded_programs.slice(0,10),_.value=e.total)},y=async()=>{const e=i.settings.mylist.filter(s=>s.type==="RecordedProgram").sort((s,m)=>m.created_at-s.created_at).map(s=>s.id);if(e.length===0){l.value=[],u.value=0;return}const t=await g.fetchVideos("ids",1,e);t&&(l.value=t.recorded_programs.slice(0,4),u.value=t.total)},f=async()=>{const e=i.settings.watched_history.sort((s,m)=>m.updated_at-s.updated_at).map(s=>s.video_id);if(e.length===0){d.value=[],c.value=0;return}const t=await g.fetchVideos("ids",1,e);t&&(d.value=t.recorded_programs.slice(0,4),c.value=t.total)},S={recentPrograms:P,mylistPrograms:y,watchedPrograms:f},w=async()=>{try{await Promise.all(Object.values(S).map(e=>e())),a.value=!1}catch(e){console.error("Failed to update sections:",e),a.value=!1}},b=()=>{n.value===null&&(w(),n.value=window.setInterval(w,W))},B=()=>{n.value!==null&&(clearInterval(n.value),n.value=null)};return A(()=>{b()}),I(()=>{B()}),(e,t)=>(U(),N("div",F,[r(R),h("main",null,[r(L),h("div",O,[r(V),h("div",T,[r(E,{crumbs:[{name:"ホーム",path:"/"},{name:"ビデオをみる",path:"/videos/",disabled:!0}]}),r(p,{class:"videos-home-container__recent-programs",title:"新着の録画番組",programs:v.value,total:_.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showSearch:!0,isLoading:a.value,showEmptyMessage:!a.value,onMore:t[0]||(t[0]=s=>e.$router.push("/videos/programs"))},null,8,["programs","total","isLoading","showEmptyMessage"]),r(p,{title:"マイリスト",programs:l.value,total:u.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showEmptyMessage:!a.value,emptyMessage:"マイリストに録画番組が<br class='d-sm-none'>追加されていません。",emptySubMessage:"録画番組の右上にある「＋」ボタンから、<br class='d-sm-none'>マイリストに番組を追加できます。",isLoading:a.value,forMylist:!0,onMore:t[1]||(t[1]=s=>e.$router.push("/mylist/"))},null,8,["programs","total","showEmptyMessage","isLoading"]),r(p,{title:"視聴履歴",programs:d.value,total:c.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showEmptyMessage:!a.value,emptyMessage:"まだ視聴履歴がありません。",emptySubMessage:"録画番組を30秒以上みると、<br class='d-sm-none'>視聴履歴に追加されます。",isLoading:a.value,forWatchedHistory:!0,onMore:t[2]||(t[2]=s=>e.$router.push("/watched-history/"))},null,8,["programs","total","showEmptyMessage","isLoading"])])])])]))}}),te=k(j,[["__scopeId","data-v-81626244"]]);export{te as default};
